#!/usr/bin/env python

import sys, os

template="""<?xml version="1.0" ?>
<?xml-stylesheet type='text/xsl' href='interface.xsl'?>
<interface uri="http://gfxmonk.net/dist/0install/%(filename)s" xmlns="http://zero-install.sourceforge.net/2004/injector/interface" xmlns:compile="http://zero-install.sourceforge.net/2006/namespaces/0compile" xmlns:release="http://zero-install.sourceforge.net/2007/namespaces/0release">

	<name>%(name)s</name>
	<summary>___</summary>
	<publish mode="featured|third-party|package|0tools|ignore" xmlns="http://gfxmonk.net/dist/0install"/>
	<description>
	___
	</description>
	<homepage>___</homepage>
	<package-implementation package="___" distributions="Debian|RPM"/>
	<feed-for interface="http://gfxmonk.net/dist/0install/%(filename)s"/>
%(implementation)s
</interface>
"""

binary_template="""
	<group>
		<command name="run" path="___">
			<runner interface="___"/>
		</command>
		<requires interface="___"/>
		<environment name="___" insert="" mode="prepend" />

		<implementation id="." version="0.0.1">
		</implementation>
	</group>
"""

source_template="""
	<group arch="*-src" compile:min-version="0.23">
		<requires interface=""/>
		<command name="compile" shell-command="">
			<requires interface="___"/>
			<environment name="___" insert="" mode="prepend" />
			<compile:implementation>
				<command name="run" path="___"/>
			</compile:implementation>
		</command>
		<implementation id="." version="0.0.1">
		</implementation>
	</group>
"""

from optparse import OptionParser
p = OptionParser("usage: 0template [OPTIONS] filename.xml")
p.add_option('-s', '--source', action='store_true', default=False, help="create a src feed (using 0compile)")
opts, args = p.parse_args()

assert len(args) == 1, p.format_help()
path = args[0]
assert not os.path.exists(path), "Error: file already exists!"
filename = os.path.basename(path)
name = os.path.splitext(filename)[0]

impl_template = source_template if opts.source else binary_template

with open(path, 'w') as output:
	print >> output, template % dict(name=name, filename=filename, implementation=impl_template),
