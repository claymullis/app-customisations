#!/bin/bash
set -e
if [ -z "$WATCHDOG_ARGS" ]; then
	WATCHDOG_ARGS=""
fi
set -u
if [ "$#" -eq 0 ]; then
	cmd="gup -u all"
else
	cmd="gup -u $*"
fi
zeroenv="0install run http://gfxmonk.net/dist/0install/0env.xml"
gup="http://gfxmonk.net/dist/0install/gup.xml"
$zeroenv $gup -- $cmd
echo "(initial build complete - watching for changes)"
$zeroenv $gup -- watchdog shell-command -c "$cmd" -i '*/.gup/*;*~' -D --wait --recursive $WATCHDOG_ARGS .
